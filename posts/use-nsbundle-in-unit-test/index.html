<!doctype html><html lang=zn-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>在iOS单元测试中使用NSBundle - 小於的宅基地</title><meta name=Description content="但愿每次回忆都不觉愧疚！"><meta property="og:title" content="在iOS单元测试中使用NSBundle"><meta property="og:description" content="最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。
一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了NSBundle来获取app中打包进去的资源。但是调试发现根本无法定位资源。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-08-28T17:02:00+08:00"><meta property="article:modified_time" content="2012-08-28T17:02:00+08:00"><meta property="og:site_name" content="小於的宅基地"><meta name=twitter:card content="summary"><meta name=twitter:title content="在iOS单元测试中使用NSBundle"><meta name=twitter:description content="最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。
一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了NSBundle来获取app中打包进去的资源。但是调试发现根本无法定位资源。"><meta name=application-name content="小於的宅基地"><meta name=apple-mobile-web-app-title content="小於的宅基地"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@agassi_yzh"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/><link rel=prev href=https://www.yuzhuohui.info/posts/xcode-targets/><link rel=next href=https://www.yuzhuohui.info/posts/vim-plugin-syntastic/><link rel=stylesheet href=/css/main.d5cb6f29e0750a13b17688d628b04d50f9fbbd32e0629ccc0dcf796a299ae226.css integrity="sha256-1ctvKeB1ChOxdojWKLBNUPn7vTLgYpzMDc95aima4iY="><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/color.b0a0f8c429ce52dfa2805b5f9e99ccdae1e8fbfd9adf4f3ddb409d8201fc0c5a.css integrity="sha256-sKD4xCnOUt+igFtfnpnM2uHo+/2a308920CdggH8DFo="><link rel=stylesheet href=/css/style.min.f2aabe7ed2d9cd12141e4933ea581079a6166c7c32ea2903169671317768588c.css integrity="sha256-8qq+ftLZzRIUHkkz6lgQeaYWbHwy6ikDFpZxMXdoWIw="><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"在iOS单元测试中使用NSBundle","inLanguage":"zn-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/"},"genre":"posts","wordcount":441,"url":"https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/","datePublished":"2012-08-28T17:02:00+08:00","dateModified":"2012-08-28T17:02:00+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"小於"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=小於的宅基地>小於的宅基地</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=https://kindle.yuzhuohui.info rel="noopener noreferrer" target=_blank>Kindle </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=小於的宅基地>小於的宅基地</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=https://kindle.yuzhuohui.info title rel="noopener noreferrer" target=_blank>Kindle</a><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title></h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">在iOS单元测试中使用NSBundle</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=https://twitter.com/Agassi_yzh title=Author target=_blank rel="noopener noreferrer author" class=author>小於</a>
</span>&nbsp;<span class=post-category></span>&nbsp;<span class=post-category></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2012-08-28>2012-08-28</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2012-08-28>2012-08-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span></span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><p>最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。</p><p>一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了<code>NSBundle</code>来获取app中打包进去的资源。但是调试发现根本无法定位资源。</p><p>后来在<a href="https://stackoverflow.com/questions/3067015/ocunit-nsbundle?answertab=active#tab-top" target=_blank rel="noopener noreferrer">stackoverfolow</a>中看到是<code>[NSBundle mainBundle]</code>这个方法出的问题。Apple官方文档中对这个方法的解释是：</p><blockquote><p>This method allocates and initializes a bundle object if one doesn’t already exist. The new object corresponds to the directory where the application executable is located. Be sure to check the return value to make sure you have a valid bundle. This method may return a valid bundle object even for unbundled applications.</p></blockquote><blockquote><p>In general, the main bundle corresponds to an application file package or application wrapper: a directory that bears the name of the application and is marked by a “.app” extension.</p></blockquote><p><a href="https://stackoverflow.com/questions/3067015/ocunit-nsbundle?answertab=active#tab-top" target=_blank rel="noopener noreferrer">stackoverfolow</a>对这个问题提出了解决方案。</p><p>可以用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=n>myClass</span> <span class=k>class</span><span class=p>]]</span>
</span></span></code></pre></div><p>或者：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=nb>self</span> <span class=k>class</span><span class=p>]]</span>
</span></span></code></pre></div><p>来替代<code>[NSBundle mainBundle]</code>。</p><p>这个看起来不错，但是我想在不是单元测试的时候用[NSBundle mainBundle]，这个时候可以参考我之前的一篇文章<a href rel>用同一套代码写不同版本的客户端</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=cp>#ifdef UnitTest
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>NSURL</span> <span class=o>*</span><span class=n>bundleURL</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=nb>self</span> <span class=k>class</span><span class=p>]]</span> <span class=nl>URLForResource</span><span class=p>:</span><span class=n>CLIENT_NAME</span> <span class=nl>withExtension</span><span class=p>:</span><span class=s>@&#34;bundle&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>NSURL</span> <span class=o>*</span><span class=n>bundleURL</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSBundle</span> <span class=n>mainBundle</span><span class=p>]</span> <span class=nl>URLForResource</span><span class=p>:</span><span class=n>CLIENT_NAME</span> <span class=nl>withExtension</span><span class=p>:</span><span class=s>@&#34;bundle&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><button title=" Twitter" data-sharer=twitter data-url=https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/ data-title=在iOS单元测试中使用NSBundle data-via=agassi_yzh><span class="fab fa-twitter fa-fw"></span></button><button title=" Facebook" data-sharer=facebook data-url=https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/><span class="fab fa-facebook-square fa-fw"></span></button><button title=" Hacker News" data-sharer=hackernews data-url=https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/ data-title=在iOS单元测试中使用NSBundle><span class="fab fa-hacker-news fa-fw"></span></button><button title=" Line" data-sharer=line data-url=https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/ data-title=在iOS单元测试中使用NSBundle><span data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@v5.21.1/icons/line.svg></span></button><button title=" 微博" data-sharer=weibo data-url=https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/ data-title=在iOS单元测试中使用NSBundle><span class="fab fa-weibo fa-fw"></span></button></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()></a></span>&nbsp;|&nbsp;<span><a href=/></a></span></section></div><div class=post-nav><a href=/posts/xcode-targets/ class=prev rel=prev title=用同一套代码写不同版本的客户端><i class="fas fa-angle-left fa-fw"></i>用同一套代码写不同版本的客户端</a>
<a href=/posts/vim-plugin-syntastic/ class=next rel=next title=vim插件推荐：Syntastic>vim插件推荐：Syntastic<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>&nbsp;|&nbsp;</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2011 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://twitter.com/Agassi_yzh target=_blank rel="noopener noreferrer">小於</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css><script type=text/javascript>window.config={code:{copyTitle:"",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},sharerjs:!0}</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.2/sharer.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=https://iamagassi.disqus.com/embed.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-13148173-4",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-13148173-4" async></script></div></body></html>