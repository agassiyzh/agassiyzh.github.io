<!doctype html><html lang=zn-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>在iOS单元测试中使用NSBundle - 小於的宅基地</title><meta name=Description content><meta property="og:title" content="在iOS单元测试中使用NSBundle"><meta property="og:description" content="最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。
一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了NSBundle来获取app中打包进去的资源。但是调试发现根本无法定位资源。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-08-28T17:02:00+08:00"><meta property="article:modified_time" content="2012-08-28T17:02:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="在iOS单元测试中使用NSBundle"><meta name=twitter:description content="最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。
一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了NSBundle来获取app中打包进去的资源。但是调试发现根本无法定位资源。"><meta name=application-name content="小於的宅基地"><meta name=apple-mobile-web-app-title content="小於的宅基地"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.yuzhuohui.info/posts/use-nsbundle-in-unit-test/><link rel=prev href=https://www.yuzhuohui.info/posts/xcode-targets/><link rel=next href=https://www.yuzhuohui.info/posts/vim-plugin-syntastic/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"在iOS单元测试中使用NSBundle","inLanguage":"zn-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.yuzhuohui.info\/posts\/use-nsbundle-in-unit-test\/"},"genre":"posts","wordcount":441,"url":"https:\/\/www.yuzhuohui.info\/posts\/use-nsbundle-in-unit-test\/","datePublished":"2012-08-28T17:02:00+08:00","dateModified":"2012-08-28T17:02:00+08:00","publisher":{"@type":"Organization","name":"小於"},"author":{"@type":"Person","name":"小於"},"description":""}</script></head><body header-desktop header-mobile><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=小於的宅基地>小於的宅基地</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=小於的宅基地>小於的宅基地</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">在iOS单元测试中使用NSBundle</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://twitter.com/Agassi_yzh title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>小於</a></span>&nbsp;<span class=post-category>included in <a href=/categories/ios/><i class="far fa-folder fa-fw"></i>iOS</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2012-08-28>2012-08-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;441 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;One minute&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><p>最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。</p><p>一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了<code>NSBundle</code>来获取app中打包进去的资源。但是调试发现根本无法定位资源。</p><p>后来在<a href="https://stackoverflow.com/questions/3067015/ocunit-nsbundle?answertab=active#tab-top" target=_blank rel="noopener noreffer">stackoverfolow</a>中看到是<code>[NSBundle mainBundle]</code>这个方法出的问题。Apple官方文档中对这个方法的解释是：</p><blockquote><p>This method allocates and initializes a bundle object if one doesn’t already exist. The new object corresponds to the directory where the application executable is located. Be sure to check the return value to make sure you have a valid bundle. This method may return a valid bundle object even for unbundled applications.</p></blockquote><blockquote><p>In general, the main bundle corresponds to an application file package or application wrapper: a directory that bears the name of the application and is marked by a “.app” extension.</p></blockquote><p><a href="https://stackoverflow.com/questions/3067015/ocunit-nsbundle?answertab=active#tab-top" target=_blank rel="noopener noreffer">stackoverfolow</a>对这个问题提出了解决方案。</p><p>可以用</p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=n>myClass</span> <span class=k>class</span><span class=p>]]</span>
</code></pre></div><p>或者：</p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=nb>self</span> <span class=k>class</span><span class=p>]]</span>
</code></pre></div><p>来替代<code>[NSBundle mainBundle]</code>。</p><p>这个看起来不错，但是我想在不是单元测试的时候用[NSBundle mainBundle]，这个时候可以参考我之前的一篇文章<a href rel>用同一套代码写不同版本的客户端</a></p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=cp>#ifdef UnitTest
</span><span class=cp></span><span class=n>NSURL</span> <span class=o>*</span><span class=n>bundleURL</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=nb>self</span> <span class=k>class</span><span class=p>]]</span> <span class=nl>URLForResource</span><span class=p>:</span><span class=n>CLIENT_NAME</span> <span class=nl>withExtension</span><span class=p>:</span><span class=s>@&#34;bundle&#34;</span><span class=p>];</span>
<span class=cp>#else
</span><span class=cp></span><span class=n>NSURL</span> <span class=o>*</span><span class=n>bundleURL</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSBundle</span> <span class=n>mainBundle</span><span class=p>]</span> <span class=nl>URLForResource</span><span class=p>:</span><span class=n>CLIENT_NAME</span> <span class=nl>withExtension</span><span class=p>:</span><span class=s>@&#34;bundle&#34;</span><span class=p>];</span>
<span class=cp>#endif
</span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2012-08-28</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/xcode-targets/ class=prev rel=prev title=用同一套代码写不同版本的客户端><i class="fas fa-angle-left fa-fw"></i>用同一套代码写不同版本的客户端</a>
<a href=/posts/vim-plugin-syntastic/ class=next rel=next title=vim插件推荐：Syntastic>vim插件推荐：Syntastic<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.85.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://twitter.com/Agassi_yzh target=_blank>小於</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://iamagassi.disqus.com/embed.js defer></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},search:{highlightTag:null,maxResultLength:null,noResultsFound:"No results found",snippetLength:null}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-13148173-4',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-13148173-4" async></script></body></html>